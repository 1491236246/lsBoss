(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2527d9f8"],{"55da":function(t,e,s){},b9bf:function(t,e,s){"use strict";var i=s("55da"),a=s.n(i);a.a},be4f:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"goodsAppend global_div"},[i("content-top",{attrs:{titlename:"添加商品"}}),i("div",{staticClass:"center_div"},[i("div",{staticClass:"body"},[i("el-steps",{attrs:{active:t.stepActive,"align-center":""}},[i("el-step",{attrs:{title:"选择商品分类"}}),i("el-step",{attrs:{title:"填写商品信息"}}),i("el-step",{attrs:{title:"填写商品属性"}}),i("el-step",{attrs:{title:"选择商品关联"}})],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"form-wrap flex"},[1==t.stepActive?i("div",[i("div",{staticClass:"flex"},[i("div",{staticClass:"form-label"},[t._v("基本信息")]),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"select-category flex h-center"},[i("div",{staticClass:"flex-1"},[i("div",{staticClass:"title font-18 gray bold"},[t._v("选择一级分类")]),i("ul",{staticClass:"category-list"},t._l(t.categoryList,function(e){return i("li",{class:t.ruleForm.typeId==e.id?"active":"",on:{click:function(s){t.getCategory(e)}}},[i("span",[t._v(t._s(e.typeName))]),i("i",{staticClass:"el-icon-arrow-right fr"})])}),0)]),i("img",{attrs:{src:s("cdae"),alt:""}}),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"title font-18 gray bold"},[t._v("选择二级分类")]),t.childCategoryList.length>0?i("ul",{staticClass:"category-list"},t._l(t.childCategoryList,function(e){return i("li",{class:t.ruleForm.childId==e.id?"active":"",on:{click:function(s){t.getChildCategory(e)}}},[t._v(t._s(e.typeName))])}),0):t._e(),0==t.childCategoryList.length?i("div",{staticClass:"category-list"},[i("span",{staticClass:"empty"},[t._v("暂无分类")])]):t._e()]),i("p",{staticClass:"tips"},[t._v("您当前选择的商品类别是：\n              "),i("span",[t._v(t._s(t.categoryName||"未选择"))]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.childCategoryName,expression:"childCategoryName"}]},[t._v(" > "+t._s(t.childCategoryName||"未选择"))])]),i("el-button",{attrs:{type:"primary"},on:{click:t.submit1}},[t._v("下一步，填写商品信息")])],1)])])]):t._e(),2==t.stepActive?i("div",[i("div",{staticClass:"flex"},[t._m(0),i("el-form",{ref:"ruleForm",staticClass:"form-info",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"商品分类: "}},[i("span",{staticClass:"font-14 green bold",on:{click:function(e){t.setpActive=1}}},[t._v(t._s(t.categoryName))]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.childCategoryName,expression:"childCategoryName"}],staticClass:"font-14 green bold"},[t._v(t._s(" > "+t.childCategoryName))])]),i("el-form-item",{attrs:{label:"商品名称: ",prop:"goodsName"}},[i("el-input",{model:{value:t.ruleForm.goodsName,callback:function(e){t.$set(t.ruleForm,"goodsName",e)},expression:"ruleForm.goodsName"}})],1),i("el-form-item",{attrs:{label:"副标题: ",prop:"goodsSubtitle"}},[i("el-input",{model:{value:t.ruleForm.goodsSubtitle,callback:function(e){t.$set(t.ruleForm,"goodsSubtitle",e)},expression:"ruleForm.goodsSubtitle"}})],1),i("el-form-item",{attrs:{label:"商品品牌: ",prop:"brandId"}},[i("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.ruleForm.brandId,callback:function(e){t.$set(t.ruleForm,"brandId",e)},expression:"ruleForm.brandId"}},t._l(t.brandList,function(t){return i("el-option",{attrs:{label:t.name,value:t.id}})}),1)],1),i("el-form-item",{attrs:{label:"商品介绍",prop:"goodsDesc"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.ruleForm.goodsDesc,callback:function(e){t.$set(t.ruleForm,"goodsDesc",e)},expression:"ruleForm.goodsDesc"}})],1),i("el-form-item",{attrs:{label:"商品货号: ",prop:"goodsNo"}},[i("el-input",{attrs:{placeholder:""},model:{value:t.ruleForm.goodsNo,callback:function(e){t.$set(t.ruleForm,"goodsNo",e)},expression:"ruleForm.goodsNo"}}),i("p",{staticClass:"form-tips"},[t._v("如果您不输入商品货号，系统将自动生成一个唯一的货号")])],1),i("el-form-item",{attrs:{label:"商品售价: ",prop:"goodsPrice"}},[i("el-input",{attrs:{type:"number"},model:{value:t.ruleForm.goodsPrice,callback:function(e){t.$set(t.ruleForm,"goodsPrice",e)},expression:"ruleForm.goodsPrice"}})],1),i("el-form-item",{attrs:{label:"市场价: ",prop:"marketPrice"}},[i("el-input",{attrs:{type:"number"},model:{value:t.ruleForm.marketPrice,callback:function(e){t.$set(t.ruleForm,"marketPrice",e)},expression:"ruleForm.marketPrice"}})],1),i("el-form-item",{attrs:{label:"商品库存: ",prop:"goodsStock"}},[i("el-input",{attrs:{type:"number"},model:{value:t.ruleForm.goodsStock,callback:function(e){t.$set(t.ruleForm,"goodsStock",e)},expression:"ruleForm.goodsStock"}}),i("p",{staticClass:"form-tips"},[t._v("该设置只对单品有效，当商品存在多规格货品时为不可编辑状态，库存数值取决于货品数量")])],1),i("el-form-item",{attrs:{label:"库存预警值: ",prop:"goodsWarning"}},[i("el-input",{attrs:{type:"number"},model:{value:t.ruleForm.goodsWarning,callback:function(e){t.$set(t.ruleForm,"goodsWarning",e)},expression:"ruleForm.goodsWarning"}})],1),i("el-form-item",{attrs:{label:"计量单位: ",prop:"goodsUnit"}},[i("el-input",{model:{value:t.ruleForm.goodsUnit,callback:function(e){t.$set(t.ruleForm,"goodsUnit",e)},expression:"ruleForm.goodsUnit"}})],1),i("el-form-item",{attrs:{label:"商品重量: ",prop:"goodsWeight"}},[i("el-input",{model:{value:t.ruleForm.goodsWeight,callback:function(e){t.$set(t.ruleForm,"goodsWeight",e)},expression:"ruleForm.goodsWeight"}})],1),i("el-form-item",[i("el-button",{on:{click:function(e){t.stepActive=1}}},[t._v("上一步,选择商品分类")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("下一步,填写商品属性")])],1)],1)],1)]):t._e(),3==t.stepActive?i("div",[i("div",{staticClass:"form-item-3 flex"},[i("div",{staticClass:"form-label"},[t._v("商品属性")]),i("div",{staticClass:"flex-1"},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.propLoading,expression:"propLoading"}],staticClass:"form-prop",attrs:{"label-width":"100px"}},[i("el-form-item",{attrs:{label:"商品类型: "}},[i("el-select",{attrs:{disabled:!t.isAdd,placeholder:"请选择商品类型"},on:{change:t.getProp},model:{value:t.ruleForm.styleId,callback:function(e){t.$set(t.ruleForm,"styleId",e)},expression:"ruleForm.styleId"}},t._l(t.typeList,function(t){return i("el-option",{attrs:{label:t.styleName,value:t.id}})}),1)],1),t.propList.length>0?i("el-form-item",{attrs:{label:"商品规格: "}},[i("div",{staticClass:"prop-wrap"},[t._l(t.propList,function(e,s){return i("el-checkbox-group",{key:s,model:{value:t.checkProp,callback:function(e){t.checkProp=e},expression:"checkProp"}},[i("div",{staticClass:"font-14 gray"},[t._v(t._s(e.name))]),t._l(e.value,function(s){return i("el-checkbox",{attrs:{disabled:!t.isAdd,label:e.name+s},on:{change:function(i){t.handleCheckProp(s,e.name,i)}}},[t._v(t._s(s))])})],2)}),i("div",[t.isAdd?i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addProps}},[t._v("添加")]):t._e()],1)],2)]):t._e()],1),i("table",{directives:[{name:"show",rawName:"v-show",value:t.propSpecList.length>0,expression:"propSpecList.length > 0"}],staticClass:"goods-table",attrs:{border:"1"}},[i("thead",[t._l(t.propHeader,function(e){return i("td",[t._v(t._s(e))])}),i("td",[t._v("销售价格")]),i("td",[t._v("商品库存")]),i("td",[t._v("库存预警值")])],2),i("tbody",t._l(t.propSpecList,function(e){return i("tr",[t._l(e.nameValue,function(e){return i("td",[t._v(t._s(e.value))])}),i("td",[i("el-input",{attrs:{size:"mini",type:"number",max:99999},model:{value:e.goodsSalePrice,callback:function(s){t.$set(e,"goodsSalePrice",s)},expression:"item.goodsSalePrice"}})],1),i("td",[i("el-input",{attrs:{size:"mini",type:"number",max:99999},model:{value:e.goodsStock,callback:function(s){t.$set(e,"goodsStock",s)},expression:"item.goodsStock"}})],1),i("td",[i("el-input",{attrs:{size:"mini",type:"number",max:99999},model:{value:e.stockWarning,callback:function(s){t.$set(e,"stockWarning",s)},expression:"item.stockWarning"}})],1)],2)}),0)])],1)]),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.propLoading,expression:"propLoading"}],staticClass:"form-item-3 flex"},[i("div",{staticClass:"form-label"},[t._v("商品参数")]),i("div",{staticClass:"flex-1"},[i("table",{staticClass:"goods-table",attrs:{border:"1"}},[t._m(1),i("tbody",[t._l(t.paramsList,function(e,s){return i("tr",[i("td",[t._v(t._s(e.name||e.paramDetailName))]),i("td",[i("el-select",{attrs:{placeholder:"请选择商品参数值"},model:{value:t.ruleForm.merchantParamDetailIds.merchantParamDetails[s].specificationsValue,callback:function(e){t.$set(t.ruleForm.merchantParamDetailIds.merchantParamDetails[s],"specificationsValue",e)},expression:"ruleForm.merchantParamDetailIds.merchantParamDetails[index].specificationsValue"}},t._l(e.list,function(t){return i("el-option",{attrs:{label:t,value:t}})}),1)],1)])}),i("tr",[i("td",[t._v("主材含量")]),i("td",[i("el-input",{attrs:{size:"mini"},model:{value:t.ruleForm.merchantParamDetailIds.mainMaterial,callback:function(e){t.$set(t.ruleForm.merchantParamDetailIds,"mainMaterial",e)},expression:"ruleForm.merchantParamDetailIds.mainMaterial"}})],1)]),i("tr",[i("td",[t._v("适用对象")]),i("td",[i("el-input",{attrs:{size:"mini"},model:{value:t.ruleForm.merchantParamDetailIds.paramObject,callback:function(e){t.$set(t.ruleForm.merchantParamDetailIds,"paramObject",e)},expression:"ruleForm.merchantParamDetailIds.paramObject"}})],1)])],2)])])]),i("div",{staticClass:"form-item-3 flex"},[i("div",{staticClass:"form-label"},[t._v("商品相册")]),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"flex"},t._l(t.imgList,function(e,s){return i("div",{key:s,staticClass:"upload-wrap"},[i("div",{staticClass:"img-wrap"},[i("img",{attrs:{src:e,alt:""}}),e?t._e():i("i",{staticClass:"el-icon-picture"})]),i("div",{staticClass:"flex h-center around"},[0==s?i("span",{staticClass:"font-14 red"},[t._v("商品主图")]):t._e(),0!=s?i("span",{staticClass:"font-14 green table-btn",on:{click:function(i){t.setMainPic(e,s)}}},[t._v("设为主图")]):t._e(),i("span",{staticClass:"font-14 green table-btn",on:{click:function(e){t.deleteImg(s)}}},[t._v("删除图片")])])])}),0),i("div",{staticClass:"flex h-center"},[i("div",{staticClass:"upload-btn-wrap"},[i("label",{attrs:{for:"upload"}},[i("el-button",{attrs:{type:"primary"}},[t._v("上传图片")])],1),i("input",{staticClass:"upload-input large",attrs:{id:"upload",type:"file",accept:"image/jpeg, image/png"},on:{change:t.uploadGoodImg}})]),i("el-button",{staticStyle:{float:"left","margin-top":"20px"},attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("从图片库选择")])],1),i("br"),i("p",{staticClass:"form-tips"},[t._v("最多可以上传5张图片，建议尺寸800*800px")])])]),i("div",{staticClass:"form-item-3 flex"},[i("div",{staticClass:"form-label"},[t._v("商品详情")]),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"editor"},[i("quill-editor",{ref:"myQuillEditor",staticClass:"editor",attrs:{options:t.editorOption},model:{value:t.ruleForm.goodsMobileImg,callback:function(e){t.$set(t.ruleForm,"goodsMobileImg",e)},expression:"ruleForm.goodsMobileImg"}}),i("el-upload",{attrs:{id:"uploadEditor",hidden:"",action:t.serverUrl,accept:"image/jpeg, image/png","http-request":t.uploadEditor}})],1),i("div",{staticStyle:{"margin-top":"80px"}},[i("el-button",{on:{click:function(e){t.stepActive=2}}},[t._v("上一步,填写商品信息")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitGood}},[t._v("下一步,选择商品类目")])],1)])])]):t._e(),4==t.stepActive?i("div",[i("div",{staticClass:"flex"},[i("div",{staticClass:"form-label"},[t._v("关联类目")]),i("div",{staticClass:"flex-1"},[i("p",{staticClass:"form-tips"},[t._v("* 类目非必选 | 选了一级类目必须选择二级类目")]),i("div",{staticClass:"select-category flex h-center",staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"flex-1"},[i("div",{staticClass:"title font-18 gray bold"},[t._v("选择一级类目")]),i("ul",{staticClass:"category-list"},t._l(t.headerList,function(e){return i("li",{class:t.ruleForm.navId==e.id?"active":"",on:{click:function(s){t.getHeader(e)}}},[i("span",[t._v(t._s(e.navName))]),i("i",{staticClass:"el-icon-arrow-right fr"})])}),0)]),i("img",{attrs:{src:s("cdae"),alt:""}}),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"title font-18 gray bold"},[t._v("选择二级类目")]),t.childHeaderList.length>0?i("ul",{staticClass:"category-list"},t._l(t.childHeaderList,function(e){return i("li",{class:t.ruleForm.navChildId==e.id?"active":"",on:{click:function(s){t.getChildHeader(e)}}},[t._v(t._s(e.navName))])}),0):t._e(),0==t.childHeaderList.length?i("div",{staticClass:"category-list"},[i("span",{staticClass:"empty"},[t._v("暂无类目")])]):t._e()])]),i("div",{staticStyle:{"margin-top":"20px"}},[i("el-button",{on:{click:function(e){t.stepActive=3}}},[t._v("上一步,填写商品属性")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitGoods}},[t._v("完成,提交商品")])],1)])])]):t._e()]),i("el-dialog",{attrs:{title:"从图库选择",visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"flex between h-center"},[i("span",[t._v("商品图库 > 全部图片")]),i("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择图库分类",size:"small"},on:{change:t.getAlbumImg},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}},t._l(t.albumList,function(t){return i("el-option",{attrs:{value:t.id,label:t.name}})}),1)],1),i("div",{staticClass:"img-table flex"},t._l(t.albumImgList,function(e,s){return i("div",{key:s,on:{click:function(s){t.checkAlbumImg(e)}}},[i("img",{attrs:{src:e.imgUrl,alt:""}}),t.checkAlbumImgList.indexOf(e.imgUrl)>=0?i("i",{staticClass:"el-icon-success"}):t._e()])}),0),i("pagination",{staticClass:"pagination",attrs:{isBatch:!1,total:t.total,pageSize:t.pageSize},on:{next:t.next}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.addImg}},[t._v("确 定")])],1)],1)],1)])],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"form-label"},[t._v("基本信息")]),s("div",{staticClass:"form-label label-2"},[t._v("库存规格")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("td",[t._v("参数类型")]),s("td",[t._v("录入参数")])])}],r=(s("2f62"),s("953d"),s("5c96"));const o=[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["link","image","video"],["clean"]];var l={name:"goodsAppend",data(){let t=(t,e,s)=>{""===e?s(new Error("请输入商品库存")):e>99999?s(new Error("商品库存最大值为99999")):e<0?s(new Error("商品库存不能小于0")):s()};return{visibleSearch:!1,input:"",currentPage:1,pageSize:10,pageCount:0,total:0,isAdd:!0,loading:!0,stockTypeList:[],loading:!1,categoryList:[],childCategoryList:[],categoryName:"",childCategoryName:"",typeId:"",childTypeId:"",brandList:[],dialogVisible:!1,stepActive:1,ruleForm:{typeId:"",childId:"",goodsName:"",goodsSubtitle:"",brandId:"",goodsDesc:"",goodsNo:"",goodsPrice:"",marketPrice:"",goodsStock:"",goodsWarning:"",goodsUnit:"",goodsWeight:"",styleId:"",merchantSpecifications:[],merchantGoodsTypePropertyList:[],merchantParamDetailIds:{merchantParamDetails:[],mainMaterial:"",paramObject:""},goodsImg:"",navId:"",navChildId:""},rules:{goodsName:[{required:!0,message:"请输入商品名称",trigger:"blur"},{max:20,message:"长度必须小于20个字符",trigger:"blur"}],goodsSubtitle:[{required:!0,message:"请输入副标题",trigger:"blur"},{max:20,message:"长度必须小于20个字符",trigger:"blur"}],brandId:[{required:!0,message:"请选择品牌",trigger:"change"}],goodsDesc:[{required:!0,message:"请输入商品介绍",trigger:"blur"}],goodsPrice:[{required:!0,message:"请输入商品售价",trigger:"blur"}],goodsStock:[{required:!0,validator:t,trigger:"blur"}],goodsWarning:[{required:!0,message:"请输入库存预警值",trigger:"blur"}]},typeList:[],goodsTypeId:"",propList:[],checkProp:[],checkPropList:[],propSpecList:[],propHeader:[],propLoading:!1,paramsList:[],imgList:[],goodsMobileImg:"",albumList:[],albumId:"",albumImgList:[],checkAlbumImgList:[],oldStyleId:"",oldPropList:[],oldCheckProp:[],oldPropHeader:[],oldCheckPropList:[],oldPropSpecList:[],oldMerchantParamDetailIds:{},headerList:[],childHeaderList:[],newFormData:{},quillUpdateImg:!1,serverUrl:"https://ls.diandianyuyue.com",editorOption:{placeholder:"",theme:"snow",modules:{toolbar:{container:o,handlers:{image:function(t){t?document.querySelector("#uploadEditor input").click():this.quill.format("image",!1)}}}}}}},mounted(){this.loading=!0,this.$http.post("merchantGoodsType/query_goods_type_tree").then(t=>{this.categoryList=t,this.$http.post("merchant_goods_brand/query_list").then(t=>{this.brandList=t,this.$http.post("merchantGoodsStyle/merchant_goods_style_list_page",{currentPage:1,pageSize:100}).then(t=>{this.typeList=t.list,this.$http.post("merchant_goods_galleries/query_for_page",{currentPage:1,pageSize:100}).then(t=>{this.albumList=t.list,this.$http.post("merchantNavigation/query_navigation_type_tree").then(t=>{this.headerList=t,this.$route.query.id&&(this.isAdd=!1,this.$http.post("merchantGoods/merchant_goods_by_id",{id:this.$route.query.id}).then(t=>{this.categoryName=t.typeName,this.childCategoryName=t.childName,this.$set(this.ruleForm,"typeId",t.typeId),String(t.childId)&&(this.$set(this.ruleForm,"childId",t.childId),this.categoryList.map(e=>{e.id==t.typeId&&(this.childCategoryList=e.list)})),this.$set(this.ruleForm,"goodsName",t.goodsName),this.$set(this.ruleForm,"goodsSubtitle",t.goodsSubtitle),this.$set(this.ruleForm,"brandId",t.brandId),this.$set(this.ruleForm,"goodsDesc",t.goodsDesc),this.$set(this.ruleForm,"goodsNo",t.goodsNo),this.$set(this.ruleForm,"goodsPrice",t.goodsPrice),this.$set(this.ruleForm,"marketPrice",t.marketPrice),this.$set(this.ruleForm,"goodsStock",t.goodsStock),this.$set(this.ruleForm,"goodsWarning",t.goodsWarning),this.$set(this.ruleForm,"goodsUnit",t.goodsUnit),this.$set(this.ruleForm,"goodsWeight",t.goodsWeight),this.$set(this.ruleForm,"goodsMobileImg",t.goodsMobileImg),this.$set(this.ruleForm,"styleId",t.styleId),this.$set(this.ruleForm,"merchantParamDetailIds",t.merchantParamDetailIds),this.$set(this.ruleForm,"navId",t.navId),this.$set(this.ruleForm,"navChildId",t.navChildId),String(t.navId)&&this.headerList.map(e=>{e.id==t.navId&&(this.childHeaderList=e.list)}),this.paramsList=t.merchantParamDetailIds.merchantParamDetails,this.propSpecList=t.merchantGoodsTypePropertyList,this.$http.post("merchantGoodsProperty/merchant_goods_property_list_page",{styleId:t.styleId,currentPage:1,pageSize:100}).then(e=>{let s=[];e.list.map(t=>{s.push({name:t.propertyName,value:t.propertyList.split(",")})}),this.propList=s,this.checkPropList=t.map;let i=[],a=[];this.checkPropList.map(t=>{a.push(t.name),t.value.map(e=>{i.push(t.name+e)})}),this.checkProp=i,this.propHeader=a,this.oldStyleId=t.styleId,this.oldPropList=s,this.oldCheckProp=i,this.oldCheckPropList=t.map,this.oldPropHeader=a,this.oldPropSpecList=t.merchantGoodsTypePropertyList,this.oldMerchantParamDetailIds=t.merchantParamDetailIds,t.goodsImg&&(this.imgList=t.goodsImg.split(",")),this.loading=!1})})),this.loading=!1})})})})})},methods:{uploadEditor(t){this.uploadFiles(t.file).then(t=>{let e=t.imgUrl;if(e){let t=this.$refs.myQuillEditor.quill,s=t.getSelection().index;t.insertEmbed(s,"image",e),t.setSelection(s+1)}else r["Message"].error("上传失败")})},getCategory(t){this.ruleForm.typeId!=t.id&&(this.ruleForm.typeId=t.id,this.ruleForm.childId="",this.childCategoryList=t.list,this.categoryName=t.typeName)},getChildCategory(t){this.ruleForm.childId=t.id,this.childCategoryName=t.typeName},getHeader(t){this.ruleForm.navId!=t.id?(this.ruleForm.navId=t.id,this.ruleForm.navChildId="",this.childHeaderList=t.list):(this.ruleForm.navId="",this.ruleForm.navChildId="",this.childHeaderList=[])},getChildHeader(t){this.ruleForm.navChildId=t.id},submit1(){this.ruleForm.typeId?this.stepActive=2:r["Message"].warning("请先选择商品分类")},submitForm(t){this.$refs[t].validate(t=>{if(!t)return!1;this.stepActive=3,document.documentElement.scrollTop=0})},handleCheckProp(t,e,s){if(s)if(0==this.checkPropList.length)this.checkPropList.push({name:e,value:[t]});else{let s=!1;for(let i=0;i<this.checkPropList.length;i++)if(this.checkPropList[i].name==e){this.checkPropList[i].value.push(t),s=!0;break}s||this.checkPropList.push({name:e,value:[t]})}else for(let i=0;i<this.checkPropList.length;i++)if(this.checkPropList[i].name==e)for(let e=0;e<this.checkPropList[i].value.length;e++)if(this.checkPropList[i].value[e]==t)return this.checkPropList[i].value.splice(e,1),void(0==this.checkPropList[i].value.length&&this.checkPropList.splice(i,1))},addProps(){if(!this.ruleForm.styleId)return void r["Message"].warning("请选择商品类型");if(0==this.checkPropList.length)return void r["Message"].warning("请选择商品属性");let t=[],e=[];this.checkPropList.map((s,i)=>{t.push(s.name),e[i]=[],this.checkPropList[i].value.map(t=>{e[i].push({name:this.checkPropList[i].name,value:t})})}),this.propHeader=t;let s=i(e);function i(t){var e=t.length;if(e>=2){for(var s=t[0].length,a=t[1].length,r=s*a,o=new Array(r),l=0,n=0;n<s;n++)for(var c=0;c<a;c++)t[0][n]instanceof Array?o[l]=[...t[0][n],t[1][c]]:o[l]=[t[0][n],t[1][c]],l++;var d=new Array(e-1);for(n=2;n<t.length;n++)d[n-1]=t[n];return d[0]=o,i(d)}return t[0]}this.propSpecList=[],s.map(t=>{this.propSpecList.push({nameValue:t instanceof Array?t:[t],goodsSalePrice:"",goodsStock:"",stockWarning:"",skuCode:""})})},getProp(t){t==this.oldStyleId?(this.propList=this.oldPropList,this.checkProp=this.oldCheckProp,this.checkPropList=this.oldCheckPropList,this.propHeader=this.oldPropHeader,this.propSpecList=this.oldPropSpecList,this.ruleForm.merchantParamDetailIds=this.oldMerchantParamDetailIds,this.$http.post("merchantGoodsParam/merchant_goods_property_list_page",{styleId:t,currentPage:1,pageSize:100}).then(t=>{let e=[];t.list.map(t=>{e.push({name:t.paramName,list:t.paramList.split(",")})}),this.paramsList=e})):(this.checkProp=[],this.checkPropList=[],this.propHeader=[],this.propSpecList=[],this.propLoading=!0,this.$http.post("merchantGoodsProperty/merchant_goods_property_list_page",{styleId:t,currentPage:1,pageSize:100}).then(e=>{let s=[];e.list.map(t=>{s.push({name:t.propertyName,value:t.propertyList.split(",")})}),this.propList=s,this.$http.post("merchantGoodsParam/merchant_goods_property_list_page",{styleId:t,currentPage:1,pageSize:100}).then(t=>{let e=[],s=[];t.list.map(t=>{e.push({name:t.paramName,list:t.paramList.split(",")}),s.push({paramDetailName:t.paramName,specificationsValue:""})}),this.paramsList=e,this.$set(this.ruleForm,"merchantParamDetailIds",{merchantParamDetails:s,mainMaterial:"",paramObject:""}),this.propLoading=!1})}))},uploadFiles(t){return new Promise((e,s)=>{let i=new FormData;i.append("file",t),this.$http.post("merchant/upload_file",i,{type:"form",file:"image"}).then(t=>{e({imgUrl:t.imgUrl+t.image})},t=>{this.$msgErr(t),s(t)})})},uploadGoodImg(t){let e=t.target.files;if(e.length+this.imgList.length>5)return void r["Message"].warning("图片最多5张");let s=this.imgList,i=[];for(let a=0;a<e.length;a++)e[a]!=[]&&i.push(this.uploadFiles(e[a]));Promise.all(i).then(t=>{t.map(t=>{s.push(t.imgUrl)})},()=>{r["Message"].error("上传失败")})},deleteImg(t){this.imgList.splice(t,1)},getAlbumImg(t){this.albumId=t,this.$http.post("merchant_goods_galleries_detail/query_for_page",{currentPage:this.currentPage,pageSize:this.pageSize,galleriesId:t}).then(t=>{this.albumImgList=t.list,this.total=t.totalCount})},next(t){this.currentPage=t,this.getAlbumImg(this.albumId)},checkAlbumImg(t){if(this.checkAlbumImgList.indexOf(t.imgUrl)<0){if(this.checkAlbumImgList.length+this.imgList.length>=5)return void r["Message"].warning("最多添加5张");this.checkAlbumImgList.push(t.imgUrl)}else this.checkAlbumImgList.splice(this.checkAlbumImgList.indexOf(t.imgUrl),1)},addImg(){this.imgList=[...this.imgList,...this.checkAlbumImgList],this.checkAlbumImgList=[],this.dialogVisible=!1},submitGood(){let t=this.ruleForm;if(t.styleId)if(0!=this.checkPropList.length)if(0!=this.propSpecList.length){for(let t=0;t<this.propSpecList.length;t++){let e=this.propSpecList[t];if(!e.goodsSalePrice||!e.goodsStock||!e.stockWarning)return void r["Message"].warning("请填写完整商品规格列表");if(e.goodsStock>99999||!e.stockWarning>99999)return void r["Message"].warning("库存最大值为99999");if(e.goodsSalePrice<0)return void r["Message"].warning("规格列表销售价格不能小于0");if(e.goodsStock<0)return void r["Message"].warning("规格列表库存不能小于0");if(e.stockWarning<0)return void r["Message"].warning("规格列表库存预警值不能小于0")}for(let e=0;e<t.merchantParamDetailIds.merchantParamDetails.length;e++)if(!t.merchantParamDetailIds.merchantParamDetails[e].specificationsValue)return void r["Message"].warning("请选择商品参数");t.merchantParamDetailIds.mainMaterial&&t.merchantParamDetailIds.paramObject?0!=this.imgList.length?this.stepActive=4:r["Message"].warning("请上传商品图片"):r["Message"].warning("请填写商品参数")}else r["Message"].warning("请添加商品规格列表");else r["Message"].warning("请选择商品规格");else r["Message"].warning("请选择商品类型")},setMainPic(t,e){this.imgList.splice(e,1),this.imgList.unshift(t)},submitGoods(){if(this.ruleForm.navId&&!this.ruleForm.navChildId)return void r["Message"].warning("选了一级类目必须选择二级类目");let t=JSON.parse(JSON.stringify(this.ruleForm));t.merchantParamDetailIds.merchantParamDetails||(t.merchantParamDetailIds.merchantParamDetails=[]),t.goodsImg=this.imgList.join(","),t.merchantSpecifications=this.checkPropList,t.merchantGoodsTypePropertyList=this.propSpecList,this.isAdd?this.$http.post("merchantGoods/merchant_goods_add",t).then(()=>{r["Message"].waringSuc("添加商品成功"),setTimeout(()=>{this.back()},500)},t=>{r["Message"].error(t.msg)}):(t.id=this.$route.query.id,this.$http.post("merchantGoods/merchant_goods_update",t).then(()=>{r["Message"].waringSuc("修改成功"),setTimeout(()=>{this.back()},500)},t=>{r["Message"].error(t.msg)}))}}},n=l,c=(s("b9bf"),s("2877")),d=Object(c["a"])(n,i,a,!1,null,"2f7b7a5a",null);d.options.__file="goodsAppend.vue";e["default"]=d.exports},cdae:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAkCAYAAADLsGk3AAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAcBJREFUWIXV1ztoFUEYxfHf1QgWFikUBMHK0kIDgoUWKRKwE0HFB9jZhBTa2KhF7BTSWKWPjYLYiJBAAloYULFJYXWFQEAIAVlEEJ/FuIXXXLLZ58xpFna+Pfv9+c4ss71+lmlJD/AQa02Y72rCdIhO4h0mmzBvEwT24wVmsLtO47ZB8nfewSIO1mnalcbx/u+1sroEIUxkUZhQpV66BiHslRlh7xwoaxIDSK5JIWqnyzwcEwgcwhJuobeTB3v9LHvcSEv/a1z4/BbVc1zDZpHiXj/LfpfpqiWt4SJWtiuMLVqDOoyXuGGbqMUOAnswi6cYHVaUAkius3iDY1stpgQCR/Aa1wcXUgOBvZjDPPblN1MEyXVFiNpR4v/8FtFXTKU8kX800nUDFfUB57Ga8kQe4QRWSXOzf8M0ruJLfjO1aH3EBbwdXEhpIs8wZgsI0gD5jps4h8/DimKPVuFj/AieNN5OUOM/VmWaKqNXOFWg7gdu4z4Knzpii9Y6LgnQO1JMm30Bx5WAIA6Qn7iLM9goa9J1tD7hMparGnU5kWUhSpUh6AbkF+5hQphILWo7WptClBbqNm5zIivCWal2CPgDscRRGBicstQAAAAASUVORK5CYII="}}]);
//# sourceMappingURL=chunk-2527d9f8.d668dd45.js.map